elsif (req.http.host == "<%= name -%>"<% if not aliases.empty? -%><% aliases.each do |vhost_alias| -%> ||
        req.http.host == "<%= name_alias -%>"<% end -%><% end -%>) {
<% if not esi.empty? -%>

<% if scope.function_versioncmp([varnish_version_real, '3.0.0']) >= 0 -%>
    set beresp.do_esi = true;
<% else -%>
    esi;
<% end end -%>
<% if not nocache.empty? -%>

    # Disable caching for certain locations.
    if (req.url ~ "<%= [nocache].flatten.join('" ||
        req.url ~ "') -%>") {
        # Prevent the cache status from persisting.
        set beresp.ttl = 0s;
<% if scope.function_versioncmp([scope.lookupvar('varnish::config::varnish_version_real'), '3.0.0']) >= 0 -%>
        return(hit_for_pass);
<% else -%>
        return(pass);
<% end -%>
    }
<% end -%>

