<% backend_hosts.each do |backend_host| -%>
backend <%= director_name -%>_<%= backend_host.gsub(/-|\./, "_") -%>_<%= backend_port -%> {
    .host   = "<%= backend_host -%>";
    .port   = "<%= backend_port -%>";
    .probe  = {
        .url = "<%= probe_url -%>";
<% %w{window threshold interval timeout}.each do |probe_key|
    probe_val = scope.lookupvar("probe_#{probe_key}")
    if probe_val != '' -%>
        .<%= probe_key -%> = <%= probe_val -%>;
<% end
end -%>
    }
}
<% end -%>
director <%= director_name -%> <%= director_type -%> {
<% backend_hosts.each do |backend_host| -%>
    { .backend = <%= director_name -%>_<%= backend_host.gsub(/-|\./, "_") -%>_<%= backend_port -%>; }
<% end -%>
}

